<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Organograma 1º BBM - Porto Alegre</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'bombeiros-orange': '#FF8C00',
            'bombeiros-yellow': '#FFD700',
            'fire-red': '#DC2626',
            'bg-deep': '#0f172a'
          },
          fontFamily: { sans: ['Inter', 'sans-serif'] }
        }
      }
    }
  </script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">

  <style>
    body { background-color: #0f172a; color: #fff; font-family: Inter, sans-serif; }
    .watermark {
      position: fixed; left: 5%; right: 5%; top: 220px; bottom: 20px;
      background-image: url('https://github.com/ciabm-1bbm/site/blob/main/images/brasao_1BBM_PARA_site.png?raw=true');
      background-position: center top; background-repeat: no-repeat; background-size: contain;
      opacity: 0.08; filter: grayscale(100%); pointer-events: none; z-index: 0;
    }
    .node-card {
      background: rgba(30,41,59,0.85); border: 1px solid rgba(255,255,255,0.06);
      border-radius: 0.75rem; padding: 0.75rem 1rem; min-width: 220px;
      transition: transform .18s ease, box-shadow .18s ease;
      backdrop-filter: blur(6px);
    }
    .node-card:hover { transform: translateY(-6px) scale(1.02); box-shadow: 0 18px 40px rgba(0,0,0,0.6); }
    .node-title { font-weight: 800; letter-spacing: .6px; }
    .node-sub { color: #cbd5e1; font-size: .85rem; margin-top: .25rem; }
    .tooltip {
      position: absolute; transform: translate(-50%, -120%); white-space: nowrap;
      background: rgba(2,6,23,0.95); color: #fff; padding: .45rem .6rem; border-radius: .5rem;
      font-size: .85rem; border: 1px solid rgba(255,255,255,0.06); z-index: 60; pointer-events: none;
      box-shadow: 0 8px 30px rgba(2,6,23,0.6);
    }
    .connector { width: 2px; background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); }
    .badge { background: linear-gradient(90deg,#FF8C00,#FFD700); color: #0b1220; font-weight:700; padding: .15rem .5rem; border-radius: 999px; font-size:.8rem; }
    /* responsive tree */
    .tree-row { display:flex; gap:1rem; align-items:flex-start; justify-content:center; flex-wrap:wrap; }
    .collapse-btn { background: transparent; border: none; color: #9ca3af; cursor: pointer; }
  </style>
</head>
<body class="min-h-screen">

  <div class="watermark" aria-hidden="true"></div>

  <div class="max-w-7xl mx-auto p-6 relative z-20">
    <header class="flex items-center justify-between gap-4 mb-6">
      <div class="flex items-center gap-4">
        <img src="https://www.bombeiros.rs.gov.br/themes/sitecbmrs/images/logos/logo.png" alt="CBMRS" class="h-16">
        <div>
          <h1 class="text-2xl md:text-3xl font-black">Organograma 1º BBM - Porto Alegre</h1>
          <p class="text-sm text-gray-300 mt-1">Visualização hierárquica com quantitativos por posto/graduação</p>
        </div>
      </div>
      <div class="text-right">
        <img src="https://github.com/ciabm-1bbm/site/blob/main/images/brasao_1BBM_PARA_site.png?raw=true" alt="Brasão" class="h-16 opacity-95">
      </div>
    </header>

    <main class="bg-transparent">
      <div id="org-root" class="flex flex-col items-center gap-6"></div>
    </main>

    <footer class="mt-8 text-center text-xs text-gray-400">
      © 2026 1º Batalhão de Bombeiro Militar — Porto Alegre
    </footer>
  </div>

  <template id="node-template">
    <div class="node-card relative">
      <div class="flex items-start justify-between gap-3">
        <div>
          <div class="node-title text-white"></div>
          <div class="node-sub"></div>
        </div>
        <div class="flex items-center gap-2">
          <div class="badge"></div>
          <button class="collapse-btn" aria-label="Expandir/Colapsar">
            <svg class="w-5 h-5 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </template>

  <div id="tooltip" class="tooltip hidden"></div>

  <script>
    /*************************************************************************
     * Dados do organograma (extraídos e organizados a partir do PDF)
     * Ajuste os números conforme necessário. Cada nó pode ter:
     *  - title: texto exibido
     *  - subtitle: função/posto
     *  - counts: objeto com chaves (Cel, TCel, Maj, Cap, 1Ten, 1Sgt, 2Sgt, Sd)
     *  - children: array de nós filhos
     *************************************************************************/

    const orgData = {
      title: "Comandante do 1º BBM",
      subtitle: "Posto: (Comandante)",
      counts: { "Cel":0,"TCel":0,"Maj":0,"Cap":0,"1º Ten":0,"1º Sgt":0,"2º Sgt":0,"Sd":1 },
      children: [
        {
          title: "Setor de Comando e Correição (Batalhão)",
          subtitle: "SAdmC / SODC / ALI",
          counts: { "Cel":0,"TCel":1,"Maj":1,"Cap":0,"1º Ten":0,"1º Sgt":1,"2º Sgt":8,"Sd":7 },
          children: []
        },
        {
          title: "1ª Companhia de Bombeiro Militar",
          subtitle: "Comandante e 5 Pelotões",
          counts: { "Cel":0,"TCel":0,"Maj":0,"Cap":1,"1º Ten":5,"1º Sgt":10,"2º Sgt":17,"Sd":78 },
          children: [
            {
              title: "1º Pel BM Açorianos",
              subtitle: "Cmt / 1º GBM / 2º GBM",
              counts: { "1º Ten":1,"1º Sgt":2,"2º Sgt":3,"Sd":19 } // resumo
            },
            {
              title: "2º Pel BM Teresópolis",
              subtitle: "Cmt / 1º GBM / 2º GBM",
              counts: { "1º Ten":1,"1º Sgt":2,"2º Sgt":3,"Sd":21 }
            },
            {
              title: "3º Pel BM Assunção",
              subtitle: "Cmt / 1º GBM / 2º GBM",
              counts: { "1º Ten":1,"1º Sgt":4,"2º Sgt":3,"Sd":21 }
            },
            {
              title: "4º Pel BM Restinga",
              subtitle: "Cmt / 1º GBM / 2º GBM",
              counts: { "1º Ten":1,"1º Sgt":3,"2º Sgt":3,"Sd":20 }
            },
            {
              title: "5º Pel BM Belém Novo",
              subtitle: "Cmt / 1º GBM / 2º GBM",
              counts: { "1º Ten":1,"1º Sgt":2,"2º Sgt":2,"Sd":20 }
            }
          ]
        },
        {
          title: "2ª Companhia de Bombeiro Militar",
          subtitle: "Comandante e 3 Pelotões",
          counts: { "Cel":0,"TCel":0,"Maj":0,"Cap":1,"1º Ten":3,"1º Sgt":7,"2º Sgt":12,"Sd":46 },
          children: [
            { title: "1º Pel BM Floresta", subtitle: "Cmt / 1º GBM / 2º GBM", counts: { "1º Ten":1,"1º Sgt":2,"2º Sgt":2,"Sd":21 } },
            { title: "2º Pel BM Passo D'Areia", subtitle: "Cmt / 1º GBM / 2º GBM", counts: { "1º Ten":1,"1º Sgt":2,"2º Sgt":2,"Sd":20 } },
            { title: "3º Pel BM Partenon", subtitle: "Cmt / 1º GBM / 2º GBM", counts: { "1º Ten":1,"1º Sgt":3,"2º Sgt":3,"Sd":22 } }
          ]
        },
        {
          title: "Divisões e Seções (CRBM)",
          subtitle: "Administração, Inteligência, Operações, Logística, Comunicação, Segurança",
          counts: { "Cel":1,"TCel":0,"Maj":1,"Cap":2,"1º Ten":0,"1º Sgt":10,"2º Sgt":8,"Sd":16 },
          children: [
            { title: "Divisão Administrativa e Correcional", counts: { "Cap":1,"1º Sgt":3,"2º Sgt":2,"Sd":4 } },
            { title: "Agência Regional de Inteligência", counts: { "Maj":1,"1º Sgt":1,"2º Sgt":1,"Sd":2 } },
            { title: "Divisão de Operações e Defesa Civil", counts: { "1º Sgt":1,"2º Sgt":1,"Sd":1 } },
            { title: "Divisão de Logística Patrimônio e Finanças", counts: { "Cap":1,"1º Sgt":4,"2º Sgt":2,"Sd":6 } },
            { title: "Divisão de Comunicação Social", counts: { "Maj":1,"2º Sgt":1,"Sd":1 } },
            { title: "Divisão de Segurança Contra Incêndio", counts: { "Maj":1,"1º Sgt":1,"2º Sgt":1,"Sd":2 } }
          ]
        }
      ]
    };

    /*************************************************************************
     * Funções de renderização
     *************************************************************************/
    const rootEl = document.getElementById('org-root');
    const nodeTpl = document.getElementById('node-template');
    const tooltip = document.getElementById('tooltip');

    function formatCounts(counts) {
      if (!counts) return 'Sem dados';
      return Object.entries(counts).map(([k,v]) => `${k}: ${v ?? 0}`).join(' • ');
    }

    function createNode(nodeData) {
      const tpl = nodeTpl.content.cloneNode(true);
      const card = tpl.querySelector('.node-card');
      const titleEl = tpl.querySelector('.node-title');
      const subEl = tpl.querySelector('.node-sub');
      const badge = tpl.querySelector('.badge');
      const collapseBtn = tpl.querySelector('.collapse-btn');

      titleEl.textContent = nodeData.title;
      subEl.textContent = nodeData.subtitle || '';
      badge.textContent = Object.values(nodeData.counts || {}).reduce((a,b)=>a+(b||0),0);

      // tooltip on hover
      card.addEventListener('mouseenter', (e) => {
        tooltip.innerHTML = `<strong>${nodeData.title}</strong><div style="margin-top:.25rem;color:#cbd5e1">${formatCounts(nodeData.counts)}</div>`;
        tooltip.classList.remove('hidden');
        positionTooltip(e);
      });
      card.addEventListener('mousemove', positionTooltip);
      card.addEventListener('mouseleave', () => tooltip.classList.add('hidden'));

      // collapse behavior
      collapseBtn.addEventListener('click', (ev) => {
        ev.stopPropagation();
        const parent = card.parentElement;
        const childrenWrap = parent.querySelector(':scope > .children-wrap');
        if (!childrenWrap) return;
        const isHidden = childrenWrap.classList.toggle('hidden');
        collapseBtn.querySelector('svg').style.transform = isHidden ? 'rotate(0deg)' : 'rotate(180deg)';
      });

      return { el: tpl, cardEl: card };
    }

    function positionTooltip(e) {
      const rect = e.currentTarget.getBoundingClientRect();
      tooltip.style.left = (rect.left + rect.width/2) + 'px';
      tooltip.style.top = (rect.top - 8) + 'px';
    }

    function buildTree(node, container) {
      // node wrapper
      const wrapper = document.createElement('div');
      wrapper.className = 'flex flex-col items-center gap-3';

      // node element
      const nodeFrag = createNode(node);
      const nodeEl = document.createElement('div');
      nodeEl.appendChild(nodeFrag.el);
      wrapper.appendChild(nodeEl);

      // children
      if (node.children && node.children.length) {
        // connector
        const connector = document.createElement('div');
        connector.className = 'w-px h-6 connector';
        wrapper.appendChild(connector);

        const childrenWrap = document.createElement('div');
        childrenWrap.className = 'children-wrap tree-row';
        childrenWrap.style.marginTop = '6px';

        node.children.forEach(child => {
          const childContainer = document.createElement('div');
          childContainer.className = 'flex flex-col items-center gap-3';
          buildTree(child, childContainer);
          childrenWrap.appendChild(childContainer);
        });

        wrapper.appendChild(childrenWrap);
      }

      container.appendChild(wrapper);
    }

    // render
    buildTree(orgData, rootEl);

    // small accessibility: hide tooltip on scroll
    window.addEventListener('scroll', () => tooltip.classList.add('hidden'));
  </script>
</body>
</html>

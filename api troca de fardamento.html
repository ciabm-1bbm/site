<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Troca de Fardamento</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif; background-color: #f4f4f9; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: auto; background: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2 { color: #c0392b; border-bottom: 2px solid #e74c3c; padding-bottom: 10px; }
        form { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .form-group { display: flex; flex-direction: column; }
        label { margin-bottom: 5px; font-weight: bold; font-size: 0.9em; }
        input, select, button { padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 1em; }
        button { grid-column: 1 / -1; background-color: #e74c3c; color: white; font-weight: bold; border: none; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #c0392b; }
        .tables-container { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
        th { background-color: #e74c3c; color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        .loader { text-align: center; padding: 20px; font-size: 1.2em; }
        #statusMessage { text-align: center; padding: 10px; margin-top: 15px; border-radius: 5px; font-weight: bold; display: none; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        
        @media (max-width: 768px) {
            form, .tables-container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Sistema de Troca de Fardamento</h1>
    
    <h2>Cadastrar Item para Troca</h2>
    <form id="swapForm">
        <div class="form-group">
            <label for="Nome">Nome Completo</label>
            <input type="text" id="Nome" name="Nome" required>
        </div>
        <div class="form-group">
            <label for="Posto">Posto/Graduação</label>
            <input type="text" id="Posto" name="Posto" required>
        </div>
        <div class="form-group">
            <label for="Item">Item com Tamanho Errado</label>
            <select id="Item" name="Item" required>
                <option value="Gandola">Gandola</option>
                <option value="Parka">Parka</option>
                <option value="Calça">Calça</option>
                <option value="Camiseta">Camiseta</option>
            </select>
        </div>
        <div class="form-group">
            <label for="TamanhoQueTenho">Tamanho que RECEBEU</label>
            <input type="text" id="TamanhoQueTenho" name="TamanhoQueTenho" placeholder="Ex: M, 42, G" required>
        </div>
        <div class="form-group">
            <label for="TamanhoQuePreciso">Tamanho que PRECISA</label>
            <input type="text" id="TamanhoQuePreciso" name="TamanhoQuePreciso" placeholder="Ex: G, 44, M" required>
        </div>
        <button type="submit">Enviar para Troca</button>
    </form>
    <div id="statusMessage"></div>

    <hr style="margin: 40px 0;">

    <div class="tables-container">
        <div>
            <h2>Peças Disponíveis para Troca</h2>
            <div id="availableLoader" class="loader">Carregando dados...</div>
            <table id="availableTable" style="display:none;">
                <thead>
                    <tr><th>Item</th><th>Tamanho</th><th>Disponibilizado por</th></tr>
                </thead>
                <tbody id="availableBody"></tbody>
            </table>
        </div>
        <div>
            <h2>Peças Necessárias</h2>
            <div id="neededLoader" class="loader">Carregando dados...</div>
            <table id="neededTable" style="display:none;">
                <thead>
                    <tr><th>Item</th><th>Tamanho</th><th>Procurado por</th></tr>
                </thead>
                <tbody id="neededBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // ###############  CONFIGURAÇÃO ###############
    // COLE AQUI A URL DO SEU APP DA WEB GERADA NO GOOGLE APPS SCRIPT
    const WEB_APP_URL = 'URL_DO_SEU_APP_DA_WEB_AQUI'; 
    // #############################################

    const form = document.getElementById('swapForm');
    const statusMessage = document.getElementById('statusMessage');

    // Função para carregar e exibir os dados
    async function loadData() {
        document.getElementById('availableLoader').style.display = 'block';
        document.getElementById('neededLoader').style.display = 'block';
        document.getElementById('availableTable').style.display = 'none';
        document.getElementById('neededTable').style.display = 'none';

        try {
            const response = await fetch(WEB_APP_URL);
            if (!response.ok) throw new Error('Erro ao buscar dados da planilha.');
            
            const data = await response.json();
            
            const availableBody = document.getElementById('availableBody');
            const neededBody = document.getElementById('neededBody');
            availableBody.innerHTML = '';
            neededBody.innerHTML = '';

            data.forEach(row => {
                // Popula a tabela de itens disponíveis
                let availableRow = `<tr>
                    <td>${row.Item}</td>
                    <td><b>${row.TamanhoQueTenho}</b></td>
                    <td>${row.Nome} (${row.Posto})</td>
                </tr>`;
                availableBody.innerHTML += availableRow;

                // Popula a tabela de itens necessários
                let neededRow = `<tr>
                    <td>${row.Item}</td>
                    <td><b>${row.TamanhoQuePreciso}</b></td>
                    <td>${row.Nome} (${row.Posto})</td>
                </tr>`;
                neededBody.innerHTML += neededRow;
            });
            
            document.getElementById('availableLoader').style.display = 'none';
            document.getElementById('neededLoader').style.display = 'none';
            document.getElementById('availableTable').style.display = 'table';
            document.getElementById('neededTable').style.display = 'table';

        } catch (error) {
            console.error('Erro:', error);
            document.getElementById('availableLoader').innerText = 'Falha ao carregar dados.';
            document.getElementById('neededLoader').innerText = 'Falha ao carregar dados.';
        }
    }

    // Evento de envio do formulário
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const submitButton = form.querySelector('button');
        submitButton.disabled = true;
        submitButton.textContent = 'Enviando...';

        const formData = new FormData(form);

        try {
            const response = await fetch(WEB_APP_URL, {
                method: 'POST',
                body: formData
            });

            const result = await response.json();

            if (result.result === 'success') {
                statusMessage.textContent = 'Item cadastrado com sucesso! As tabelas serão atualizadas.';
                statusMessage.className = 'success';
                form.reset();
                loadData(); // Recarrega os dados para incluir o novo item
            } else {
                throw new Error(result.error || 'Ocorreu um erro desconhecido.');
            }
        } catch (error) {
            console.error('Erro no envio:', error);
            statusMessage.textContent = 'Falha ao enviar. Tente novamente.';
            statusMessage.className = 'error';
        } finally {
            statusMessage.style.display = 'block';
            submitButton.disabled = false;
            submitButton.textContent = 'Enviar para Troca';
            setTimeout(() => { statusMessage.style.display = 'none'; }, 5000);
        }
    });

    // Carrega os dados quando a página é aberta
    document.addEventListener('DOMContentLoaded', loadData);

</script>

</body>
</html>
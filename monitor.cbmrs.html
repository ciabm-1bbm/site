<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoramento Bombeiros RS (Exceto POA)</title>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --card-bg: #2d2d2d;
            --text-primary: #e0e0e0;
            --accent-color: #d32f2f; /* Vermelho Bombeiro */
            --highlight: #ffca28;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
        }

        #status-bar {
            text-align: right;
            font-size: 0.9em;
            color: #888;
            margin-bottom: 20px;
        }

        /* Grid do Painel */
        #ocorrencias-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        /* Estilo do Cart√£o */
        .card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 15px;
            border-left: 5px solid var(--accent-color);
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .card h3 {
            margin: 0 0 10px 0;
            color: var(--highlight);
            font-size: 1.1em;
            text-transform: uppercase;
        }

        .card-info {
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .card-city {
            font-weight: bold;
            font-size: 1.2em;
            margin: 10px 0;
            color: #fff;
        }

        .viaturas {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #444;
            font-size: 0.85em;
        }

        .viatura-tag {
            background-color: #444;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 5px;
            display: inline-block;
            margin-bottom: 2px;
        }

        .loading {
            text-align: center;
            grid-column: 1 / -1;
            padding: 50px;
            font-size: 1.5em;
            color: #666;
        }
    </style>
</head>
<body>

<header>
    <h1>Ocorr√™ncias CBMRS - Interior</h1>
    <div id="status-bar">Carregando...</div>
</header>

<div id="ocorrencias-grid">
    <div class="loading">Buscando dados em tempo real...</div>
</div>

<script>
    // Configura√ß√£o
    const URL_FONTE = 'https://e193.cbm.rs.gov.br/aodc/oc.php';
    const PROXY_URL = 'https://api.allorigins.win/raw?url='; // Proxy para evitar bloqueio CORS
    const INTERVALO_ATUALIZACAO = 60000; // 60 segundos

    // Fun√ß√£o Principal
    async function atualizarPainel() {
        const statusBar = document.getElementById('status-bar');
        const grid = document.getElementById('ocorrencias-grid');
        
        statusBar.innerText = 'Atualizando...';

        try {
            // Busca o HTML bruto do site do governo via Proxy
            const response = await fetch(PROXY_URL + encodeURIComponent(URL_FONTE));
            const textoHtml = await response.text();

            // Cria um parser para ler o HTML recebido
            const parser = new DOMParser();
            const doc = parser.parseFromString(textoHtml, 'text/html');

            // Limpa o painel atual
            grid.innerHTML = '';
            let contador = 0;

            // L√ìGICA DE PARSE (ADAPTADA AO LAYOUT OBSERVADO)
            // O site parece usar tags H6 para TIPO e CIDADE ou uma estrutura de divs.
            // Vou usar uma estrat√©gia gen√©rica de varredura baseada no texto, 
            // pois a estrutura exata de classes n√£o √© vis√≠vel sem inspe√ß√£o profunda.
            
            // Vamos selecionar os containers principais. Supondo que sejam divs ou trs.
            // Se o site usa Bootstrap ou divs gen√©ricas, vamos tentar identificar padr√µes.
            // Estrat√©gia: Pegar todo o texto e dividir pelos blocos visuais ou tentar achar os elementos container.
            
            // *Tentativa de extra√ß√£o baseada na estrutura padr√£o do CBM:*
            // Geralmente s√£o "cards" dentro de um container "row" ou "col".
            // Vou iterar sobre elementos que parecem conter a estrutura de ocorr√™ncia.
            
            // Procura elementos que cont√™m o cabe√ßalho de tipo (geralmente h6 ou h5)
            const possiveisOcorrencias = doc.querySelectorAll('div.col-sm-6, div.col-md-4, td'); // Classes comuns bootstrap ou tabelas

            // Se n√£o achar por classe, tenta achar pelo padr√£o visual dos H6
            const headersTipo = doc.querySelectorAll('h6'); 

            // Agrupa os dados baseados nos headers (Cada ocorr√™ncia come√ßa com um Tipo)
            // O padr√£o parece ser: H6 (Tipo) -> Texto (ID/Data) -> H6 (Cidade) -> Texto (Endere√ßo)
            
            // Vamos iterar pelos headers de TIPO e pegar os irm√£os seguintes
            for (let i = 0; i < headersTipo.length; i++) {
                let elTipo = headersTipo[i];
                let textoTipo = elTipo.innerText.trim();
                
                // Valida√ß√£o b√°sica se √© um cabe√ßalho de ocorr√™ncia (evita lixo)
                if (textoTipo === "") continue;

                // Tenta encontrar a cidade (proximo h6)
                // Nota: O DOM pode ter n√≥s de texto entre os elementos
                let proximoElemento = elTipo.nextElementSibling;
                let dadosDataId = "";
                let cidade = "";
                let endereco = "";
                let viaturas = "";

                // Varre os pr√≥ximos elementos at√© achar a pr√≥xima ocorr√™ncia ou fim
                // Simplifica√ß√£o: Pega o n√≥ de texto imediatamente ap√≥s o H6 do Tipo
                if (elTipo.nextSibling && elTipo.nextSibling.nodeType === 3) {
                     dadosDataId = elTipo.nextSibling.textContent.trim();
                }

                // Procura o H6 da cidade logo a frente
                let elCidade = null;
                let temp = elTipo.nextElementSibling;
                while(temp) {
                    if(temp.tagName === 'H6') {
                        elCidade = temp;
                        break;
                    }
                    temp = temp.nextElementSibling;
                    // Seguran√ßa para n√£o pular para o pr√≥ximo card de ocorr√™ncia errada
                    if(temp && temp.tagName === 'HR') break; 
                }

                if (elCidade) {
                    cidade = elCidade.innerText.trim();
                    
                    // --- FILTRO SOLICITADO ---
                    if (cidade.toUpperCase() === 'PORTO ALEGRE') {
                        continue; // Pula esta itera√ß√£o, n√£o desenha o card
                    }

                    // Pega endere√ßo (texto ap√≥s cidade)
                    if (elCidade.nextSibling) {
                        endereco = elCidade.nextSibling.textContent.trim();
                    }

                    // Tenta capturar viaturas (elementos abaixo do endere√ßo)
                    // Esta parte √© aproximada sem ver o c√≥digo fonte exato
                    let containerViaturas = elCidade.parentElement; 
                    if(containerViaturas) {
                         viaturas = containerViaturas.innerText.split('Viaturas:')[1] || "";
                    }
                } else {
                    // Se n√£o achou cidade, pode n√£o ser uma ocorr√™ncia v√°lida
                    continue; 
                }

                // Monta o Card HTML
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h3>${textoTipo}</h3>
                    <div class="card-info"><strong>ID/Data:</strong> ${dadosDataId}</div>
                    <div class="card-city">${cidade}</div>
                    <div class="card-info">üìç ${endereco}</div>
                    ${viaturas ? `<div class="viaturas">üöí ${viaturas}</div>` : ''}
                `;
                
                grid.appendChild(card);
                contador++;
            }

            // Atualiza barra de status
            const agora = new Date();
            statusBar.innerText = `Atualizado em: ${agora.toLocaleTimeString()} - Total: ${contador} ocorr√™ncias (POA Ocultado)`;

        } catch (erro) {
            console.error(erro);
            statusBar.innerText = 'Erro ao atualizar. Tentando novamente...';
            grid.innerHTML = '<div class="loading">Erro de conex√£o ou formato alterado.</div>';
        }
    }

    // Inicia o loop
    atualizarPainel();
    setInterval(atualizarPainel, INTERVALO_ATUALIZACAO);

</script>

</body>
</html>
